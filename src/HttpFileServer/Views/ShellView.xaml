<Window
    x:Class="HttpFileServer.Views.ShellView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:HttpFileServer.Controls"
    xmlns:converters="clr-namespace:HttpFileServer.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="clr-namespace:HttpFileServer.ViewModels"
    Title="{Binding Title, Mode=OneWay}"
    Width="800"
    Height="480"
    MinWidth="300"
    MinHeight="200"
    MaxWidth="800"
    MaxHeight="600"
    Background="{DynamicResource WindowBackgroundBrush}"
    FontSize="14"
    Foreground="{DynamicResource WindowForegroundBrush}"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Window.DataContext>
        <viewmodels:ShellViewModel />
    </Window.DataContext>
    <Window.Resources>
        <converters:BoolReverseConverter x:Key="boolReverse" />
        <!--  初始主题色（浅色），ViewModel 动态替换  -->
        <SolidColorBrush x:Key="WindowBackgroundBrush" Color="#FFFFFF" />
        <SolidColorBrush x:Key="WindowForegroundBrush" Color="#111111" />
        <!--  Ensure labels follow the current theme foreground for readability in dark mode  -->
        <Style TargetType="Label">
            <Setter Property="Foreground" Value="{DynamicResource WindowForegroundBrush}" />
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{DynamicResource WindowForegroundBrush}" />
        </Style>
        <SolidColorBrush x:Key="PanelBackgroundBrush" Color="#F5F5F5" />
        <SolidColorBrush x:Key="PanelBorderBrush" Color="#DDDDDD" />
        <SolidColorBrush x:Key="AccentBrush" Color="#3B82F6" />
        <!-- Subtle accent for selections in dark mode (semi-transparent) -->
        <SolidColorBrush x:Key="AccentBrushSubtle" Color="#333B82F6" />
        <!-- Inner frame for QR: semi-transparent black to reduce glare in dark mode -->
        <SolidColorBrush x:Key="InnerFrameBrush" Color="#88000000" />
        <!-- QR background can be themed to a softer color instead of pure white -->
        <SolidColorBrush x:Key="QrBackgroundBrush" Color="#FFFFFFFF" />
        <!--  Hyperlink style: use accent color and only show underline on hover  -->
        <Style TargetType="Hyperlink">
            <Setter Property="Foreground" Value="{DynamicResource AccentBrush}" />
            <Setter Property="TextDecorations" Value="{x:Null}" />
            <Setter Property="Cursor" Value="Hand" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="TextDecorations" Value="Underline" />
                </Trigger>
            </Style.Triggers>
        </Style>
        <!--  按钮基础样式，防止深色主题下被默认模板改成白色高亮  -->
        <Style x:Key="BaseButton" TargetType="Button">
            <Setter Property="Foreground" Value="{DynamicResource WindowForegroundBrush}" />
            <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource PanelBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="4,0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            x:Name="bd"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="{DynamicResource AccentBrush}" />
                                <Setter Property="Foreground" Value="White" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="{DynamicResource AccentBrush}" />
                                <Setter TargetName="bd" Property="Opacity" Value="0.85" />
                                <Setter Property="Foreground" Value="White" />
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="bd" Property="BorderBrush" Value="{DynamicResource AccentBrush}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="bd" Property="Opacity" Value="0.4" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <!--  启动按钮强调样式  -->
        <Style
            x:Key="AccentButton"
            BasedOn="{StaticResource BaseButton}"
            TargetType="Button">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}" />
            <Setter Property="Foreground" Value="White" />
        </Style>
        <!--  DataGrid主题  -->
        <Style x:Key="ThemedDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource WindowForegroundBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource PanelBorderBrush}" />
            <Setter Property="HorizontalGridLinesBrush" Value="{DynamicResource PanelBorderBrush}" />
            <Setter Property="VerticalGridLinesBrush" Value="{DynamicResource PanelBorderBrush}" />
        </Style>
        <!-- Themed ListBox for dark mode: use panel background and accent selection -->
        <Style TargetType="ListBox">
            <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource WindowForegroundBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource PanelBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="2" />
            <Setter Property="ScrollViewer.Background" Value="{DynamicResource PanelBackgroundBrush}" />
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="Foreground" Value="{DynamicResource WindowForegroundBrush}" />
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Margin" Value="0" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">
                                    <Border x:Name="Bd" Background="{TemplateBinding Background}" BorderBrush="Transparent" BorderThickness="1" CornerRadius="4" Padding="2" Margin="0">
                                        <ContentPresenter />
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentBrushSubtle}" />
                                            <Setter TargetName="Bd" Property="BorderBrush" Value="{DynamicResource AccentBrush}" />
                                            <Setter Property="Foreground" Value="White" />
                                        </Trigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd" Property="BorderBrush" Value="{DynamicResource AccentBrushSubtle}" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ThemedDataGridHeader" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{DynamicResource PanelBorderBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource WindowForegroundBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource PanelBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource AccentBrush}" />
                    <Setter Property="Foreground" Value="White" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid Margin="6" Background="{DynamicResource WindowBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="1*" />
        </Grid.RowDefinitions>
        <StackPanel Margin="0,0,0,4" Background="{DynamicResource PanelBackgroundBrush}">
            <Grid Margin="-5,2,0,2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Label VerticalContentAlignment="Center" Content="路径:" />
                <controls:PathSelector
                    Grid.Column="1"
                    Height="32"
                    VerticalAlignment="Center"
                    VerticalContentAlignment="Center"
                    IsEnabled="{Binding IsRunning, Converter={StaticResource boolReverse}}"
                    SelectedPath="{Binding SourceDir, Mode=TwoWay}" />
                <WrapPanel Grid.Column="2">
                    <Label
                        Height="30"
                        VerticalContentAlignment="Center"
                        Content="端口" />
                    <TextBox
                        x:Name="tbPort"
                        Width="50"
                        Height="30"
                        VerticalContentAlignment="Center"
                        Background="{DynamicResource PanelBackgroundBrush}"
                        BorderBrush="{DynamicResource PanelBorderBrush}"
                        Foreground="{DynamicResource WindowForegroundBrush}"
                        Text="{Binding ListenPort, UpdateSourceTrigger=PropertyChanged}"
                        IsEnabled="{Binding IsRunning, Converter={StaticResource boolReverse}}" />
                </WrapPanel>
            </Grid>
            <Grid Margin="0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBox
                    x:Name="tbCurState"
                    Padding="15,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Background="{DynamicResource PanelBackgroundBrush}"
                    BorderThickness="0"
                    Foreground="{DynamicResource WindowForegroundBrush}"
                    IsReadOnly="True"
                    Text="{Binding ThemeMode, Mode=OneWay}" />
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <!--  Configuration moved to the Config tab  -->
                </StackPanel>
                <WrapPanel Grid.Column="2">
                    <Button
                        x:Name="btnRun"
                        Width="70"
                        Height="30"
                        Margin="5,0"
                        Command="{Binding CommandStartServer}"
                        Content="启动"
                        Style="{StaticResource AccentButton}" />
                    <Button
                        x:Name="BtnStop"
                        Width="70"
                        Height="30"
                        Command="{Binding CommandStopServer}"
                        Content="停止"
                        Foreground="{DynamicResource WindowForegroundBrush}"
                        Style="{StaticResource BaseButton}" />
                </WrapPanel>
                <Button
                    Grid.Column="3"
                    Width="70"
                    Height="30"
                    Margin="5,0"
                    Command="{Binding CommandToggleTheme}"
                    Content="切换主题"
                    Foreground="{DynamicResource WindowForegroundBrush}"
                    Style="{StaticResource BaseButton}" />
            </Grid>
        </StackPanel>

        <!--  Main content as tabs: 配置 / 日志 / 分享  -->
        <TabControl
            Grid.Row="1"
            Margin="0,4,0,0"
            SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}">
            <TabControl.ItemContainerStyle>
                <Style TargetType="TabItem">
                    <Setter Property="Width" Value="120" />
                    <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}" />
                    <Setter Property="Foreground" Value="{DynamicResource WindowForegroundBrush}" />
                    <Setter Property="BorderBrush" Value="{DynamicResource PanelBorderBrush}" />
                    <Setter Property="BorderThickness" Value="1" />
                    <Setter Property="Padding" Value="8,4" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border
                                    x:Name="Bd"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="4"
                                    Padding="{TemplateBinding Padding}"
                                    Margin="2,0">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" ContentSource="Header" />
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentBrush}" />
                                        <Setter Property="Foreground" Value="White" />
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentBrush}" />
                                        <Setter Property="Foreground" Value="White" />
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter TargetName="Bd" Property="Opacity" Value="0.5" />
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.ItemContainerStyle>
            <TabItem Header="配置">
                <Border
                    Padding="8"
                    Background="{DynamicResource PanelBackgroundBrush}"
                    BorderBrush="{DynamicResource PanelBorderBrush}"
                    BorderThickness="1"
                    IsEnabled="{Binding IsRunning, Converter={StaticResource boolReverse}}">
                    <StackPanel Orientation="Horizontal">
                        <CheckBox
                            x:Name="ckAutoStart"
                            Margin="5,0"
                            VerticalAlignment="Center"
                            Content="开机自启"
                            IsChecked="{Binding AutoStartWithSystem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding IsRunning, Converter={StaticResource boolReverse}}"
                            ToolTip="开机后是否自动启动程序和服务" />
                        <CheckBox
                            x:Name="ckAutoStartWithMin"
                            Margin="5,0"
                            VerticalAlignment="Center"
                            Content="最小化"
                            IsChecked="{Binding MinimizeToTrayAfterAutoStart, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding ElementName=ckAutoStart, Path=IsChecked}"
                            ToolTip="自启动后是否最小化窗口" />
                        <CheckBox
                            x:Name="ckAutoStartOnLaunch"
                            Margin="5,0"
                            VerticalAlignment="Center"
                            Content="服务自启"
                            IsChecked="{Binding AutoStartOnLaunch, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding IsRunning, Converter={StaticResource boolReverse}}"
                            ToolTip="手动启动程序后，是否自动启动服务" />
                        <CheckBox
                            x:Name="ckAllowUpload"
                            Margin="5,0"
                            VerticalAlignment="Center"
                            Content="允许上传"
                            IsChecked="{Binding EnableUpload, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding IsRunning, Converter={StaticResource boolReverse}}" />
                        <CheckBox
                            x:Name="ckWebMode"
                            Margin="5,0"
                            VerticalAlignment="Center"
                            Content="静态Web"
                            IsChecked="{Binding UseWebServer, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding IsRunning, Converter={StaticResource boolReverse}}"
                            ToolTip="启用后以静态 Web 服务器模式运行（优先返回 index.html、使用真实 MIME 类型）" />
                    </StackPanel>
                </Border>
            </TabItem>
            <TabItem Header="日志">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="100" />
                        <RowDefinition Height="1*" />
                    </Grid.RowDefinitions>
                    <Border
                        Grid.Row="0"
                        Background="{DynamicResource PanelBackgroundBrush}"
                        BorderBrush="{DynamicResource PanelBorderBrush}"
                        BorderThickness="1">
                        <DataGrid
                            AutoGenerateColumns="False"
                            ColumnHeaderStyle="{StaticResource ThemedDataGridHeader}"
                            ItemsSource="{Binding RequestModels}"
                            Style="{StaticResource ThemedDataGrid}">
                            <DataGrid.Columns>
                                <DataGridTextColumn
                                    Width="100"
                                    Binding="{Binding EndPoint}"
                                    Header="来源节点" />
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding HttpMethod}"
                                    Header="请求方法" />
                                <DataGridTextColumn
                                    Width="1*"
                                    Binding="{Binding RequestUrl}"
                                    Header="请求地址" />
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding Status}"
                                    Header="状态" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                    <Border
                        Grid.Row="1"
                        Margin="0,4,0,0"
                        VerticalAlignment="Stretch"
                        Background="{DynamicResource PanelBackgroundBrush}"
                        BorderBrush="{DynamicResource PanelBorderBrush}"
                        BorderThickness="1">
                        <TextBox
                            x:Name="logs"
                            Background="{DynamicResource PanelBackgroundBrush}"
                            Foreground="{DynamicResource WindowForegroundBrush}"
                            IsReadOnly="True"
                            ScrollViewer.HorizontalScrollBarVisibility="Auto"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                            Text="{Binding Path=LogContent, Mode=OneWay}" />
                    </Border>
                </Grid>
            </TabItem>
            <TabItem Header="分享" IsEnabled="{Binding ShareTabEnabled}">
                <Border
                    Padding="8"
                    Background="{DynamicResource PanelBackgroundBrush}"
                    BorderBrush="{DynamicResource PanelBorderBrush}"
                    BorderThickness="1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="260" />
                            <ColumnDefinition Width="8" />
                            <ColumnDefinition Width="1*" />
                        </Grid.ColumnDefinitions>
                        <!--  Left: adapter list  -->
                        <Border
                            Grid.Column="0"
                            Padding="6"
                            VerticalAlignment="Stretch"
                            Background="{DynamicResource PanelBackgroundBrush}"
                            BorderBrush="{DynamicResource PanelBorderBrush}"
                            BorderThickness="1">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="1*" />
                                </Grid.RowDefinitions>
                                <TextBlock
                                    Grid.Row="0"
                                    FontWeight="Bold"
                                    Foreground="{DynamicResource WindowForegroundBrush}"
                                    Text="网络适配器" />
                                <ListBox
                                    Grid.Row="1"
                                    VerticalAlignment="Stretch"
                                    ItemsSource="{Binding NetworkAdapters}"
                                    SelectedItem="{Binding SelectedNetworkAdapter, Mode=TwoWay}"
                                    FocusVisualStyle="{x:Null}">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border
                                                Margin="2"
                                                Padding="6"
                                                Background="Transparent"
                                                BorderBrush="Transparent"
                                                BorderThickness="0"
                                                CornerRadius="4">
                                                <StackPanel>
                                                    <TextBlock
                                                        FontWeight="Bold"
                                                        Foreground="{DynamicResource WindowForegroundBrush}"
                                                        Text="{Binding Name}" />
                                                    <TextBlock
                                                        FontSize="12"
                                                        Foreground="{DynamicResource WindowForegroundBrush}"
                                                        Text="{Binding IPv4}" />
                                                    <TextBlock
                                                        x:Name="tb6"
                                                        FontSize="12"
                                                        Foreground="{DynamicResource WindowForegroundBrush}"
                                                        Text="{Binding IPv6}" />
                                                </StackPanel>
                                            </Border>
                                            <DataTemplate.Triggers>
                                                <DataTrigger Binding="{Binding IPv6}" Value="">
                                                    <Setter TargetName="tb6" Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IPv6}" Value="{x:Null}">
                                                    <Setter TargetName="tb6" Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </DataTemplate.Triggers>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </Border>

                        <!--  Right: IPv4 / IPv6 tabs  -->
                        <Border
                            Grid.Column="2"
                            Padding="6"
                            Background="{DynamicResource PanelBackgroundBrush}"
                            BorderBrush="{DynamicResource PanelBorderBrush}"
                            BorderThickness="1">
                            <TabControl Background="{DynamicResource PanelBackgroundBrush}">
                                <TabControl.ItemContainerStyle>
                                    <Style TargetType="TabItem">
                                        <Setter Property="Width" Value="Auto" />
                                        <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}" />
                                        <Setter Property="Foreground" Value="{DynamicResource WindowForegroundBrush}" />
                                        <Setter Property="BorderBrush" Value="{DynamicResource PanelBorderBrush}" />
                                        <Setter Property="BorderThickness" Value="1" />
                                        <Setter Property="Padding" Value="6,2" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="TabItem">
                                                    <Border
                                                        x:Name="Bd"
                                                        Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="3"
                                                        Padding="{TemplateBinding Padding}"
                                                        Margin="0,0,4,0">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" ContentSource="Header" />
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentBrush}" />
                                                            <Setter Property="Foreground" Value="White" />
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentBrushSubtle}" />
                                                            <Setter Property="Foreground" Value="White" />
                                                        </Trigger>
                                                        <Trigger Property="IsEnabled" Value="False">
                                                            <Setter TargetName="Bd" Property="Opacity" Value="0.5" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </TabControl.ItemContainerStyle>
                                <TabItem Header="IPv4">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="1*" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Viewbox Margin="8" Stretch="Uniform">
                                            <Border Background="{DynamicResource PanelBackgroundBrush}" Padding="8">
                                                <!-- dark inner frame around the white QR area to reduce glare -->
                                                <Border Background="{DynamicResource QrBackgroundBrush}" BorderBrush="Transparent" BorderThickness="0" CornerRadius="2">
                                                    <Image
                                                        Width="256"
                                                        Height="256"
                                                        Source="{Binding IPv4QrImage}" />
                                                </Border>
                                            </Border>
                                        </Viewbox>
                                        <TextBlock
                                            Grid.Row="1"
                                            TextAlignment="Center"
                                            TextWrapping="Wrap">
                                            <Hyperlink NavigateUri="{Binding IPv4Text}" RequestNavigate="Hyperlink_RequestNavigate">
                                                <Run Text="{Binding IPv4Text, Mode=OneWay}" />
                                            </Hyperlink>
                                        </TextBlock>
                                    </Grid>
                                </TabItem>
                                <TabItem Header="IPv6">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="1*" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Viewbox Margin="8" Stretch="Uniform">
                                            <Border Background="{DynamicResource PanelBackgroundBrush}" Padding="8">
                                                <!-- dark inner frame around the white QR area to reduce glare -->
                                                <Border Background="{DynamicResource QrBackgroundBrush}" BorderBrush="Transparent" BorderThickness="0" CornerRadius="2">
                                                    <Image
                                                        Width="256"
                                                        Height="256"
                                                        Source="{Binding IPv6QrImage}" />
                                                </Border>
                                            </Border>
                                        </Viewbox>
                                        <TextBlock
                                            Grid.Row="1"
                                            TextAlignment="Center"
                                            TextWrapping="Wrap">
                                            <Hyperlink NavigateUri="{Binding IPv6Text}" RequestNavigate="Hyperlink_RequestNavigate">
                                                <Run Text="{Binding IPv6Text, Mode=OneWay}" />
                                            </Hyperlink>
                                        </TextBlock>
                                    </Grid>
                                </TabItem>
                            </TabControl>
                        </Border>
                    </Grid>
                </Border>
            </TabItem>
        </TabControl>
    </Grid>
</Window>